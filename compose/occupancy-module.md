# Occupancy Documentation

## Overview
This module is designed to:
- Collect data from the Proximity Sensor and output it using the Buzzer as an indicator
- Store collected data in both remote (MongoDB) and local (JSON file) databases
- Operate as a streamlined backend service without a complex GUI

## Hardware Configuration
The occupancy system uses:
- Proximity sensor, that when a visitor passes to the sensor the Buzzer will beep once indicating that the presense is `OCCUPIED`. But if the visitor goes out from the cubicle again the there is a double beep indicating that this will be a `VACANT`.

At the first run of the module, the system will check if the remote database MongoDB by pinging the remote server checking if there is an existing collection named `occupancy` on the remote database and also the system will check if there is a local data saved on the default location `local-data` the file named `occupancy-data.json`. The priority of checking is the remote and if the remote is uptime then check if there is a collection named `occupancy`. If the remote server is not enabled or online then use the local database instead

If done checking the databases: remote and local, then resume from the last counting on how many visitor has been count fromt the remote or local database (note the priority is always the remote database).

```
Checking the connectin to Database..
Database Connected Succesfully!
Restored the last previous updated data from: Remote and Local
The sensors are ready!
```

Instead of loggin and continous scanning of the occupancy, the system will remain as is line showing this format of line:
```
Number of Visitor: [latest number of counting from the database]
Presence: Occupied/Vacant
Visitor ID:
Total Number of Visitor: [The total number today]
```

The structure and format for the database (both remote and local) is defined on the `occu-data-format.json`

Database format:
"_id": - This is a unique identifier from the MongoDB meaning it should sync from remote to local what is the id.
"type": - indicates the entry represents as visit event
"visitor_id": - the visitor id will generate based on the previous data from the remote database (note always monitor and scan what is the last visitor id from the remote database) the remote visitor id will sync with the local visitor id so keep aware.
"start_time": - follow the formatting this is the starting time when the visitor occupied the cubicle
"end_time": - follow the formatting this is the ending time when the visitor vacant the cubicle
"duration": this is expressed as seconds the duration of the visitor inside of the cubicle

What will be the function on saving to the database?
The saving will not be continous as like logging continously and have a delay, instead the line will stop and have a new line not unless there has been change (occupied to vacant or vacant to occupied). The saving would like this

When the cubicle is vacant (note all of the data here are for placeholer and example so keep in mind only the logic of the software)
CLI Display
```
Number of Visitor: 65
Presence: Vacant
Visitor ID: 25
Total Number of Visitors: 153
Status: Null
```

Database Display
```

```
As you can see there are not yet data base recored because the visitor is not been finished yet

For example there is a visitor enters to the cubicle, then the function will proceeds, therefore the indicator will change to this
CLI Display
```
Number of Visitor: 66
Presence: Occupied
Visitor ID: 25
Total Number of Visitors: 154
Status: Null
```

Database Display
```

```
As you can see there is no yet database because the visitor is not finished using the cubicle

Meaning the visitor ID will hold who is that visitor enters on the cubicle (the unique ID "_id": will auto generated by the mongoDB so keep aware of that)
Then what if the visitor goes out from the cubicle, then this will be the display

CLI Display
```
Number of Visitor: 66
Presence: Vacant
Visitor ID: 26
Total Number of Visitors: 154
Status: DATA SAVED TO REMOTE AND LOCAL
```

Database Display
```
{
    "_id": "ObjectId('6a92847bcde3f1b9244c671d')", 
    "type": "visit",
    "visitor_id": 25,
    "start_time": "2025-03-15T14:23:17.000000",
    "end_time": "2025-03-15T14:31:45.000000", 
    "duration": 508
}
```
meaning that the database data is the last information of the visitor record

The script will interrupt if the user is pressed the CTRL + C and when terminated the last data will be saved immediately to the remote and local database.